 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 1 - 2019/04/24 21時44分12秒


       1/       0 :                     ;-----------------------------------------------------------------------
       2/       0 :                     ; Z80 Monitor KUNI-NET
       3/       0 :                     ;-----------------------------------------------------------------------
       4/       0 :                     ; 以下のルーチンはSBC8080データパックのASMソースを参考にさせていただきました。
       5/       0 :                     ;  SERINT 	8251シリアル割り込みルーチン
       6/       0 :                     ;  CIN		シリアル1文字入力ルーチン
       7/       0 :                     ;  COUT		シリアル1文字出力ルーチン
       8/       0 :                     ;  CKINCHAR	シリアルバッファチェックルーチン
       9/       0 :                     
      10/       0 : =DH                 CR		EQU	0DH
      11/       0 : =AH                 LF		EQU	0AH
      12/       0 : =1BH                ESC		EQU	1BH
      13/       0 : =3H                 CTRLC	EQU	03H
      14/       0 : =CH                 CLS		EQU	0CH
      15/       0 : =20H                SPC		EQU	20h
      16/       0 : =0H                 NULL	EQU 00h
      17/       0 : =7H                 BEEP	EQU 07h
      18/       0 : =8H                 BS		EQU 08h
      19/       0 : =9H                 TAB		EQU 09h
      20/       0 : =7FH                DEL		EQU 7Fh
      21/       0 :                     ;
      22/       0 : =0H                 UARTRD	EQU	00H
      23/       0 : =1H                 UARTRC	EQU	01H
      24/       0 :                     ;
      25/       0 : =3FH                BUFSIZ	EQU	3FH
      26/       0 : =30H                BUFFUL	EQU	30H
      27/       0 : =5H                 BUFEMP	EQU	5
      28/       0 :                     ;
      29/       0 : =17H                RTSHIG	EQU	00010111B
      30/       0 : =37H                RTSLOW	EQU	00110111B
      31/       0 :                     
      32/       0 :                     
      33/       0 :                     ;------------------------------------------------------------------------------
      34/       0 :                     ; RAM バッファ & STACK
      35/       0 :                     ;------------------------------------------------------------------------------
      36/    4000 :                     		ORG	4000h
      37/    4000 :                     ;
      38/    4000 :                     SERBUF	DS	BUFSIZ
      39/    403F :                     SERINP	DS	2
      40/    4041 :                     SERRDP	DS	2
      41/    4043 :                     SERCNT	DS	1
      42/    4044 :                     BASFLG	DS	1
      43/    4045 :                     ;
      44/    4045 :                     INBUF   DS  60
      45/    4081 : =3CH                INMAX   EQU  $-INBUF
      46/    4081 :                     INEND   DS  1
      47/    4082 :                     ;
      48/    4082 :                     ARGC	DS	1
      49/    4083 :                     ARGV_1	DS	2
      50/    4085 :                     ARGV_2	DS	2
      51/    4087 :                     ARGV_3	DS	2
      52/    4089 : =3H                 ARG_MAX	EQU ($-ARGV_1)/2
      53/    4089 : =7H                 ARG_AREA_LEN EQU $-ARGC
      54/    4089 :                     ;
      55/    4089 :                         	DS	32
      56/    40A9 : =40A9H              STACK   	EQU    $
      57/    40A9 :                     
      58/    40A9 :                     
      59/    40A9 :                     
      60/       0 :                     		ORG	0000h
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 2 - 2019/04/24 21時44分12秒


      61/       0 :                     ;------------------------------------------------------------------------------
      62/       0 :                     ; RST00 リセット
      63/       0 :                     ;------------------------------------------------------------------------------
      64/       0 : F3                  RST00		DI		
      65/       1 : C3 57 01            		JP	INIT	
      66/       4 :                     
      67/       4 :                     ;------------------------------------------------------------------------------
      68/       4 :                     ; RST08 1文字送信
      69/       4 :                     ;------------------------------------------------------------------------------
      70/       8 :                     	ORG	0008H
      71/       8 : C3 A7 00            RST08		JP	COUT
      72/       B :                     
      73/       B :                     ;------------------------------------------------------------------------------
      74/       B :                     ; RST10 1文字受信
      75/       B :                     ;------------------------------------------------------------------------------
      76/      10 :                     	ORG	0010H
      77/      10 : C3 79 00            RST10		JP	CIN
      78/      13 :                     
      79/      13 :                     ;------------------------------------------------------------------------------
      80/      13 :                     ; RST18 入力バッファチェック
      81/      13 :                     ;------------------------------------------------------------------------------
      82/      18 :                     	ORG	0018H
      83/      18 : C3 B3 00            RST18		JP	CKINCHAR
      84/      1B :                     
      85/      1B :                     ;------------------------------------------------------------------------------
      86/      1B :                     ; RST38 8251A割り込みルーチン
      87/      1B :                     ;------------------------------------------------------------------------------
      88/      38 :                     	ORG	0038H
      89/      38 : C3 3B 00            RST38:	JP	SERINT 
      90/      3B :                     
      91/      3B :                     ;------------------------------------------------------------------------------
      92/      3B :                     ; 8251割り込みルーチン
      93/      3B :                     ;------------------------------------------------------------------------------
      94/      3B : F5                  SERINT:	PUSH	AF
      95/      3C : E5                  	PUSH	HL
      96/      3D : DB 01               	IN	A,(UARTRC)
      97/      3F : E6 02               	AND	00000010B
      98/      41 : CA 75 00            	JP	Z,RTS0
      99/      44 : DB 00               	IN	A,(UARTRD)
     100/      46 : F5                  	PUSH	AF
     101/      47 : 3A 43 40            	LD	A,(SERCNT)
     102/      4A : FE 3F               	CP	BUFSIZ
     103/      4C : C2 53 00            	JP	NZ,NOTFUL
     104/      4F : F1                  	POP	AF
     105/      50 : C3 75 00            	JP	RTS0
     106/      53 : 2A 3F 40            NOTFUL:	LD	HL,(SERINP)
     107/      56 : 23                  	INC	HL
     108/      57 : 7D                  	LD	A,L
     109/      58 : FE 3F               	CP	SERINP & 0FFH
     110/      5A : C2 60 00            	JP	NZ,NOTWRP
     111/      5D : 21 00 40            	LD	HL,SERBUF
     112/      60 : 22 3F 40            NOTWRP:	LD	(SERINP),HL
     113/      63 : F1                  	POP	AF
     114/      64 : 77                  	LD	(HL),A
     115/      65 : 3A 43 40            	LD	A,(SERCNT)
     116/      68 : 3C                  	INC	A
     117/      69 : 32 43 40            	LD	(SERCNT),A
     118/      6C : FE 30               	CP	BUFFUL
     119/      6E : DA 75 00            	JP	C,RTS0
     120/      71 : 3E 17               	LD	A,RTSHIG
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 3 - 2019/04/24 21時44分12秒


     121/      73 : D3 01               	OUT	(UARTRC),A
     122/      75 : E1                  RTS0:	POP	HL
     123/      76 : F1                  	POP	AF
     124/      77 : FB                  	EI
     125/      78 : C9                  	RET
     126/      79 :                     
     127/      79 :                     ;------------------------------------------------------------------------------
     128/      79 :                     ; 1文字入力(バッファから)
     129/      79 :                     ;------------------------------------------------------------------------------
     130/      79 :                     CIN:
     131/      79 : 3A 43 40            	LD	A,(SERCNT)
     132/      7C : FE 00               	CP	00H
     133/      7E : CA 79 00            	JP	Z,CIN
     134/      81 : E5                  	PUSH	HL
     135/      82 : 2A 41 40            	LD	HL,(SERRDP)
     136/      85 : 23                  	INC	HL
     137/      86 : 7D                  	LD	A,L
     138/      87 : FE 3F               	CP	SERINP & 0FFH
     139/      89 : C2 8F 00            	JP	NZ,NRWRAP
     140/      8C : 21 00 40            	LD	HL,SERBUF
     141/      8F : F3                  NRWRAP:	DI
     142/      90 : 22 41 40            	LD	(SERRDP),HL
     143/      93 : 3A 43 40            	LD	A,(SERCNT)
     144/      96 : 3D                  	DEC	A
     145/      97 : 32 43 40            	LD	(SERCNT),A
     146/      9A : FE 05               	CP	BUFEMP
     147/      9C : D2 A3 00            	JP	NC,RTS1
     148/      9F : 3E 37               	LD	A,RTSLOW
     149/      A1 : D3 01               	OUT	(UARTRC),A
     150/      A3 : 7E                  RTS1:	LD	A,(HL)
     151/      A4 : FB                  	EI
     152/      A5 : E1                  	POP	HL
     153/      A6 : C9                  	RET	
     154/      A7 :                     
     155/      A7 :                     ;------------------------------------------------------------------------------
     156/      A7 :                     ; 1文字出力
     157/      A7 :                     ;------------------------------------------------------------------------------
     158/      A7 : F5                  COUT:		PUSH	AF
     159/      A8 : DB 01               COUT1:	IN	A,(UARTRC)
     160/      AA : E6 01               	AND	01H     
     161/      AC : CA A8 00            	JP	Z,COUT1
     162/      AF : F1                  	POP	AF
     163/      B0 : D3 00               	OUT	(UARTRD),A
     164/      B2 : C9                  	RET
     165/      B3 :                     
     166/      B3 :                     ;------------------------------------------------------------------------------
     167/      B3 :                     ; 入力バッファチェック
     168/      B3 :                     ;------------------------------------------------------------------------------
     169/      B3 : 3A 43 40            CKINCHAR	LD	A,(SERCNT)
     170/      B6 : FE 00               	CP	00H
     171/      B8 : C9                  	RET
     172/      B9 :                     
     173/      B9 :                     ;==============================================================================
     174/      B9 :                     ;------------------------------------------------------------------------------
     175/      B9 :                     ; 1文字入力 英字大文字対応
     176/      B9 :                     ;------------------------------------------------------------------------------
     177/      B9 :                     GETC:
     178/      B9 : D7                      RST 10h
     179/      BA : FE 61                   CP 'a'
     180/      BC : F8                      RET M
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 4 - 2019/04/24 21時44分12秒


     181/      BD : FE 7B                   CP 'z'+1
     182/      BF : F0                      RET P
     183/      C0 : D6 20                   SUB A,20H
     184/      C2 : C9                      RET
     185/      C3 :                     
     186/      C3 :                     ;------------------------------------------------------------------------------
     187/      C3 :                     ; 文字列入力 エコーバックつき
     188/      C3 :                     ;------------------------------------------------------------------------------
     189/      C3 :                     STRIN:
     190/      C3 :                     ; INBUF クリア
     191/      C3 : 3E 00                   LD A,00H
     192/      C5 : 32 45 40                LD (INBUF),A
     193/      C8 : 21 45 40                LD HL,INBUF
     194/      CB : 11 46 40                LD DE,INBUF+1
     195/      CE : 01 3C 00                LD BC,INMAX
     196/      D1 : ED B0                   LDIR
     197/      D3 :                     ;
     198/      D3 : 21 45 40                LD HL,INBUF
     199/      D6 :                     ;
     200/      D6 :                     _STRIN_LOOP:
     201/      D6 : CD B9 00                CALL GETC
     202/      D9 : FE 0D                   CP 0Dh
     203/      DB : 28 3F                   JR Z,_STRIN_END
     204/      DD : FE 08                   CP BS
     205/      DF : 28 23                   JR Z,_BS_RTN
     206/      E1 : FE 7F               	CP DEL
     207/      E3 : 28 1F                   JR Z,_BS_RTN
     208/      E5 : FE 1B               	CP ESC
     209/      E7 : 28 19               	JR Z,_ESC_RTN
     210/      E9 :                     ;
     211/      E9 :                     ; バッファENDにきた?
     212/      E9 : 47                  	LD B,A
     213/      EA : 11 81 40            	LD DE,INEND
     214/      ED : 7A                  	LD A,D
     215/      EE : BC                  	CP H
     216/      EF : 20 05               	JR NZ,_CHAR_SET
     217/      F1 : 7B                  	LD A,E
     218/      F2 : BD                  	CP L
     219/      F3 : 28 08               	JR Z,_WARN_BEEP
     220/      F5 : 78                  	LD A,B
     221/      F6 :                     _CHAR_SET:
     222/      F6 : 77                      LD (HL),A
     223/      F7 : 23                      INC HL
     224/      F8 : CD 29 01                call CPRINT
     225/      FB : 18 D9                   JR _STRIN_LOOP
     226/      FD :                     ;
     227/      FD :                     _WARN_BEEP:
     228/      FD : 3E 07               	LD A,BEEP
     229/      FF : CF                  	RST 08h
     230/     100 : 18 D4                   JR _STRIN_LOOP
     231/     102 :                     ;
     232/     102 :                     _ESC_RTN:
     233/     102 : 3F                  	CCF
     234/     103 : C9                  	RET
     235/     104 :                     ;
     236/     104 :                     _BS_RTN:
     237/     104 : 11 45 40            	LD DE,INBUF
     238/     107 : 7A                  	LD A,D
     239/     108 : BC                  	CP H
     240/     109 : 20 04               	JR NZ,_BS_RTN2
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 5 - 2019/04/24 21時44分12秒


     241/     10B : 7B                  	LD A,E
     242/     10C : BD                  	CP L
     243/     10D : 28 EE               	JR Z,_WARN_BEEP
     244/     10F :                     ;
     245/     10F :                     _BS_RTN2:
     246/     10F : E5                      PUSH HL
     247/     110 : 21 B0 04                LD HL,BSTXT
     248/     113 : CD 20 01                CALL STRPR
     249/     116 : E1                      POP HL
     250/     117 : 2B                      DEC HL
     251/     118 : 36 00                   LD (HL),00h
     252/     11A : 18 BA                   JR _STRIN_LOOP
     253/     11C :                     ;
     254/     11C :                     _STRIN_END:
     255/     11C : CD 2F 01                CALL CRLF_PRINT
     256/     11F : C9                      RET
     257/     120 :                     
     258/     120 :                     ;------------------------------------------------------------------------------
     259/     120 :                     ; 文字列出力
     260/     120 :                     ;------------------------------------------------------------------------------
     261/     120 :                     STRPR:
     262/     120 : 7E                      LD A,(HL)
     263/     121 : B7                      OR A
     264/     122 : C8                      RET Z
     265/     123 : CD 29 01                CALL CPRINT
     266/     126 : 23                      INC HL
     267/     127 : 18 F7                   JR STRPR
     268/     129 :                     
     269/     129 :                     ;------------------------------------------------------------------------------
     270/     129 :                     ; 文字出力 (CRLF対応)
     271/     129 :                     ; IN: A - キャラクタ
     272/     129 :                     ; RET: なし
     273/     129 :                     ;------------------------------------------------------------------------------
     274/     129 :                     CPRINT:
     275/     129 : FE 0D                   CP 0Dh
     276/     12B : 28 02                   JR Z,CRLF_PRINT
     277/     12D : CF                      RST 08h
     278/     12E : C9                      RET
     279/     12F :                     
     280/     12F :                     ;------------------------------------------------------------------------------
     281/     12F :                     ; CRLF出力 (CRLF対応)
     282/     12F :                     ;------------------------------------------------------------------------------
     283/     12F :                     CRLF_PRINT:
     284/     12F : 3E 0D                   LD A,0DH
     285/     131 : CF                      RST 08H
     286/     132 : 3E 0A                   LD A,0AH
     287/     134 : CF                      RST 08h
     288/     135 : C9                      RET
     289/     136 :                     
     290/     136 :                     ;------------------------------------------------------------------------------
     291/     136 :                     ; ブランク出力 
     292/     136 :                     ;------------------------------------------------------------------------------
     293/     136 :                     SPC_PRINT:
     294/     136 : 3E 20                   LD A,SPC
     295/     138 : CF                      RST 08H
     296/     139 : C9                      RET
     297/     13A :                     
     298/     13A :                     ;------------------------------------------------------------------------------
     299/     13A :                     ; Hex2桁出力
     300/     13A :                     ;------------------------------------------------------------------------------
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 6 - 2019/04/24 21時44分12秒


     301/     13A :                     HEX2OUT:
     302/     13A : C5                  	PUSH BC
     303/     13B : 47                  	LD B,A
     304/     13C : CB 3F               	SRL A
     305/     13E : CB 3F               	SRL A
     306/     140 : CB 3F               	SRL A
     307/     142 : CB 3F               	SRL A
     308/     144 : CD 4F 01            	CALL _HEX_CNV_PR
     309/     147 : 78                  	LD A,B
     310/     148 : E6 0F               	AND 0Fh
     311/     14A : CD 4F 01            	CALL _HEX_CNV_PR
     312/     14D : C1                  	POP BC
     313/     14E : C9                  	RET
     314/     14F :                     ;
     315/     14F :                     _HEX_CNV_PR:	
     316/     14F : C6 90               	ADD A,90h
     317/     151 : 27                  	DAA
     318/     152 : CE 40               	ADC	A,40h
     319/     154 : 27                  	DAA
     320/     155 : CF                  	RST 08h
     321/     156 : C9                  	RET
     322/     157 :                     
     323/     157 :                     
     324/     157 :                     ;==============================================================================
     325/     157 :                     ;------------------------------------------------------------------------------
     326/     157 :                     ; 初期化
     327/     157 :                     ;------------------------------------------------------------------------------
     328/     157 :                     INIT:		
     329/     157 : 31 A9 40                LD  SP,STACK
     330/     15A : 21 00 40            	LD	HL,SERBUF
     331/     15D : 22 3F 40            	LD	(SERINP),HL
     332/     160 : 22 41 40            	LD	(SERRDP),HL
     333/     163 : AF                  	XOR	A
     334/     164 : 32 43 40            	LD	(SERCNT),A
     335/     167 : D3 01               	OUT	(UARTRC),A
     336/     169 : D3 01               	OUT	(UARTRC),A
     337/     16B : D3 01               	OUT	(UARTRC),A
     338/     16D : 3E 40               	LD	A,01000000B
     339/     16F : D3 01               	OUT	(UARTRC),A
     340/     171 : 3E 4E               	LD	A,01001110B
     341/     173 : D3 01               	OUT	(UARTRC),A
     342/     175 : 3E 37               	LD	A,RTSLOW
     343/     177 : D3 01               	OUT	(UARTRC),A
     344/     179 : FB                  	EI
     345/     17A :                     ;
     346/     17A :                     ;--------------------------------------------------------------------------------
     347/     17A :                     ; メイン
     348/     17A :                     ;--------------------------------------------------------------------------------
     349/     17A :                     MAIN:
     350/     17A : 21 8D 04                LD HL,OPENMSG
     351/     17D : CD 20 01                CALL STRPR
     352/     180 :                     _MAIN_LOOP:
     353/     180 : 21 80 01            	LD HL,_MAIN_LOOP
     354/     183 : E5                  	PUSH HL
     355/     184 :                     ;
     356/     184 : 3E 3E                   LD A,'>'
     357/     186 : CF                      RST 08h
     358/     187 : DD 21 56 04             LD IX,CMD_TBL
     359/     18B : CD B9 00            	CALL GETC
     360/     18E : CF                      RST 08H
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 7 - 2019/04/24 21時44分12秒


     361/     18F :                     ;
     362/     18F :                     _CMD_LOOP:
     363/     18F : F5                  	PUSH AF
     364/     190 : DD 7E 00                LD A,(IX+0)
     365/     193 : B7                  	OR A
     366/     194 : 28 14               	JR Z,_ERROR_EXIT
     367/     196 : 47                  	LD B,A
     368/     197 : F1                  	POP AF
     369/     198 : B8                      CP B
     370/     199 : 20 07               	JR NZ,_NEXT_CMD
     371/     19B : DD 6E 01                LD L,(IX+1)
     372/     19E : DD 66 02            	LD H,(IX+2)
     373/     1A1 : E9                  	JP (HL)
     374/     1A2 :                     ;
     375/     1A2 :                     _NEXT_CMD:
     376/     1A2 : DD 23               	INC IX
     377/     1A4 : DD 23               	INC IX
     378/     1A6 : DD 23               	INC IX
     379/     1A8 : 18 E5               	JR _CMD_LOOP
     380/     1AA :                     ;;
     381/     1AA :                     _ERROR_EXIT
     382/     1AA : F1                  	POP AF
     383/     1AB : CD 2F 01            	CALL CRLF_PRINT
     384/     1AE : 21 B4 05            	LD HL,HATENA_MSG
     385/     1B1 : CD 20 01            	CALL STRPR
     386/     1B4 : CD 2F 01            	CALL CRLF_PRINT
     387/     1B7 : C9                  	RET
     388/     1B8 :                     
     389/     1B8 :                     ;================================================================================
     390/     1B8 :                     ; ヘルプ出力
     391/     1B8 :                     ;================================================================================
     392/     1B8 :                     HELP_OUT:
     393/     1B8 : 21 B4 04                LD HL,HELP_MSG
     394/     1BB : 18 05               	JR _PRINT_END
     395/     1BD :                     ;
     396/     1BD :                     ;================================================================================
     397/     1BD :                     ; バージョン出力
     398/     1BD :                     ;================================================================================
     399/     1BD :                     VERSION_OUT:
     400/     1BD : 21 72 04                LD HL,VERMSG
     401/     1C0 : 18 00               	JR _PRINT_END
     402/     1C2 :                     ;
     403/     1C2 :                     ;--------------------------------------------------------------------------------
     404/     1C2 :                     ; メッセージ出力してメインへリターン
     405/     1C2 :                     ;--------------------------------------------------------------------------------
     406/     1C2 :                     _PRINT_END:
     407/     1C2 : CD 2F 01            	CALL CRLF_PRINT
     408/     1C5 : CD 20 01                CALL STRPR
     409/     1C8 : CD 2F 01            	CALL CRLF_PRINT
     410/     1CB : C9                      RET
     411/     1CC :                     
     412/     1CC :                     ;--------------------------------------------------------------------------------
     413/     1CC :                     ; HEX4桁出力
     414/     1CC :                     ;--------------------------------------------------------------------------------
     415/     1CC :                     HEX4OUT:
     416/     1CC : F5                  	PUSH AF
     417/     1CD : 7C                  	LD A,H
     418/     1CE : CD 3A 01            	CALL HEX2OUT
     419/     1D1 : 7D                  	LD A,L
     420/     1D2 : CD 3A 01            	CALL HEX2OUT
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 8 - 2019/04/24 21時44分12秒


     421/     1D5 : F1                  	POP AF
     422/     1D6 : C9                  	RET
     423/     1D7 :                     
     424/     1D7 :                     ;--------------------------------------------------------------------------------
     425/     1D7 :                     ; 入力行パース
     426/     1D7 :                     ;--------------------------------------------------------------------------------
     427/     1D7 :                     PARSER:
     428/     1D7 :                     ; 編集エリア初期化
     429/     1D7 : 21 82 40            	LD HL,ARGC
     430/     1DA : 3E 00               	LD A,0
     431/     1DC : 77                  	LD (HL),A
     432/     1DD : 11 83 40            	LD DE,ARGC+1
     433/     1E0 : 01 06 00            	LD BC,ARG_AREA_LEN-1
     434/     1E3 : ED B0               	LDIR
     435/     1E5 :                     ; 入力パラメーター パース開始
     436/     1E5 : 4F                  	LD C,A
     437/     1E6 : 21 44 40            	LD HL,INBUF-1
     438/     1E9 : DD 21 83 40         	LD IX,ARGV_1
     439/     1ED :                     ;
     440/     1ED :                     _PARSE_LOOP:
     441/     1ED : 23                  	INC HL
     442/     1EE : 7E                  	LD A,(HL)
     443/     1EF : FE 00               	CP NULL
     444/     1F1 : C8                  	RET Z
     445/     1F2 : FE 20               	CP SPC
     446/     1F4 : 28 F7               	JR Z,_PARSE_LOOP
     447/     1F6 : 0C                      INC C
     448/     1F7 : 79                  	LD A,C
     449/     1F8 : FE 04               	CP ARG_MAX+1
     450/     1FA : 30 1B               	JR NC,_PARSE_ERR
     451/     1FC : 32 82 40            	LD (ARGC),A
     452/     1FF : DD 75 00            	LD (IX+0),L
     453/     202 : DD 74 01            	LD (IX+1),H
     454/     205 : DD 23               	INC IX
     455/     207 : DD 23               	INC IX
     456/     209 :                     _PARAM_LOOP:
     457/     209 : 23                  	INC HL
     458/     20A : 7E                  	LD A,(HL)
     459/     20B : FE 00               	CP NULL
     460/     20D : C8                  	RET Z
     461/     20E : FE 20               	CP SPC
     462/     210 : 20 F7               	JR NZ,_PARAM_LOOP
     463/     212 : 3E 00               	LD A,NULL
     464/     214 : 77                  	LD (HL),A
     465/     215 : 18 D6               	JR _PARSE_LOOP
     466/     217 :                     ;
     467/     217 :                     _PARSE_ERR:
     468/     217 : 3F                  	CCF
     469/     218 : C9                  	RET
     470/     219 :                     
     471/     219 :                     ;--------------------------------------------------------------------------------
     472/     219 :                     ; HEX 2桁キャラクタ → Aレジスタ
     473/     219 :                     ;--------------------------------------------------------------------------------
     474/     219 :                     HEX2BIN:
     475/     219 : C5                  	PUSH BC
     476/     21A : 7E                  	LD A,(HL)
     477/     21B : CD 33 02            	CALL _ATOBIN
     478/     21E : 38 11               	JR C,_HEX2BIN_EXIT
     479/     220 : CB 27               	SLA A
     480/     222 : CB 27               	SLA A
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 9 - 2019/04/24 21時44分12秒


     481/     224 : CB 27               	SLA A
     482/     226 : CB 27               	SLA A
     483/     228 : 47                  	LD B,A
     484/     229 : 23                  	INC HL
     485/     22A : 7E                  	LD A,(HL)
     486/     22B : CD 33 02            	CALL _ATOBIN
     487/     22E : 38 01               	JR C,_HEX2BIN_EXIT
     488/     230 : 80                  	ADD A,B
     489/     231 :                     _HEX2BIN_EXIT:
     490/     231 : C1                  	POP BC
     491/     232 : C9                  	RET
     492/     233 :                     ;
     493/     233 :                     _ATOBIN:
     494/     233 : FE 30               	CP '0'
     495/     235 : D8                  	RET C
     496/     236 : FE 3A               	CP '9'+1
     497/     238 : 38 09               	JR C,_ATOBIN1
     498/     23A : FE 41               	CP 'A'
     499/     23C : D8                  	RET C
     500/     23D : FE 47               	CP 'F'+1
     501/     23F : 3F                  	CCF
     502/     240 : D8                  	RET C
     503/     241 : C6 09               	ADD A,09H
     504/     243 :                     _ATOBIN1:
     505/     243 : E6 0F               	AND 0Fh
     506/     245 : C9                  	RET
     507/     246 :                     ;
     508/     246 :                     
     509/     246 :                     ;--------------------------------------------------------------------------------
     510/     246 :                     ; 4バイト16進数文字列→バイナリ(HL)へ
     511/     246 :                     ;--------------------------------------------------------------------------------
     512/     246 :                     HEX4BIN:
     513/     246 : CD 19 02            	CALL HEX2BIN
     514/     249 : D8                  	RET C
     515/     24A : 57                  	LD D,A
     516/     24B : 23                  	INC HL
     517/     24C : CD 19 02            	CALL HEX2BIN
     518/     24F : D8                  	RET C
     519/     250 : 5F                  	LD E,A
     520/     251 : D5                  	PUSH DE
     521/     252 : E1                  	POP HL
     522/     253 : C9                  	RET
     523/     254 :                     ;
     524/     254 :                     ;================================================================================
     525/     254 :                     ; メモリーダンプ
     526/     254 :                     ;================================================================================
     527/     254 :                     MEM_DUMP:
     528/     254 : CD 36 01                CALL SPC_PRINT
     529/     257 :                     ;
     530/     257 : CD C3 00                CALL STRIN
     531/     25A : CD D7 01            	CALL PARSER
     532/     25D : 38 41               	JR C,_PARAM_ERR
     533/     25F :                     ; 入力パラメータ数チェック
     534/     25F : 3A 82 40            	LD A,(ARGC)
     535/     262 : FE 02               	CP 2
     536/     264 : 20 3A               	JR NZ,_PARAM_ERR
     537/     266 :                     ; 開始アドレス取得
     538/     266 : 2A 83 40            	LD HL,(ARGV_1)
     539/     269 : CD 46 02            	CALL HEX4BIN
     540/     26C : 38 32               	JR C,_PARAM_ERR
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 10 - 2019/04/24 21時44分12秒


     541/     26E : E5                  	PUSH HL
     542/     26F : DD E1               	POP IX
     543/     271 :                     ; 終了アドレス取得
     544/     271 : 2A 85 40            	LD HL,(ARGV_2)
     545/     274 : CD 46 02            	CALL HEX4BIN
     546/     277 : 38 27               	JR C,_PARAM_ERR
     547/     279 : E5                  	PUSH HL
     548/     27A : D1                  	POP DE
     549/     27B : DD E5               	PUSH IX
     550/     27D : E1                  	POP HL
     551/     27E :                     ; ダンプ実施
     552/     27E :                     _DUMP_LOOP:
     553/     27E : DF                  	RST 18h
     554/     27F : 28 05               	JR Z,_DUMP_GO
     555/     281 : D7                  	RST 10h
     556/     282 : FE 1B               	CP ESC
     557/     284 : 28 20               	JR Z,_ABORT_DUMP
     558/     286 :                     _DUMP_GO:
     559/     286 : E5                  	PUSH HL
     560/     287 : CD D7 02            	CALL DUMP16
     561/     28A : E1                  	POP HL
     562/     28B : CD AC 02            	CALL ASC16
     563/     28E : CD 2F 01            	CALL CRLF_PRINT
     564/     291 :                     ; 終了判定
     565/     291 : 7A                  	LD A,D
     566/     292 : BC                  	CP H
     567/     293 : F8                  	RET M   ; メインループへ
     568/     294 : 7B                  	LD A,E
     569/     295 : BD                  	CP L
     570/     296 : FA 9B 02            	JP M,_DUMP_END_CHECK
     571/     299 : 18 E3               	JR _DUMP_LOOP
     572/     29B :                     ;
     573/     29B :                     _DUMP_END_CHECK:
     574/     29B : 7A                  	LD A,D
     575/     29C : BC                  	CP H
     576/     29D : 20 DF               	JR NZ,_DUMP_LOOP
     577/     29F : C9                  	RET
     578/     2A0 :                     ;
     579/     2A0 :                     _PARAM_ERR:
     580/     2A0 : 21 73 05            	LD HL,PARAM_ERRMSG
     581/     2A3 : C3 C2 01            	JP _PRINT_END
     582/     2A6 :                     ;
     583/     2A6 :                     _ABORT_DUMP:
     584/     2A6 : 21 86 05            	LD HL,ABORT_MSG
     585/     2A9 : C3 C2 01            	JP _PRINT_END
     586/     2AC :                     ;--------------------------------------------------------------------------------
     587/     2AC :                     ; 16バイト分 ASCII出力
     588/     2AC :                     ;--------------------------------------------------------------------------------
     589/     2AC :                     ASC16:
     590/     2AC : CD 36 01            	CALL SPC_PRINT
     591/     2AF : 3E 3A               	LD A,':'
     592/     2B1 : CF                  	RST 08h
     593/     2B2 : CD 36 01            	CALL SPC_PRINT
     594/     2B5 : 0E 10               	LD C,10h
     595/     2B7 :                     ;
     596/     2B7 :                     _ASC16_LOOP:
     597/     2B7 : 7E                  	LD A,(HL)
     598/     2B8 : FE 20               	CP ' '
     599/     2BA : FA C2 02            	JP M,_ASC16_DOT
     600/     2BD : FE 7F               	CP 7Fh
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 11 - 2019/04/24 21時44分12秒


     601/     2BF : FA C4 02            	JP M,_ASC16_PRINT
     602/     2C2 :                     _ASC16_DOT:
     603/     2C2 : 3E 2E               	LD A,'.'
     604/     2C4 :                     _ASC16_PRINT:
     605/     2C4 : CF                  	RST 08h	
     606/     2C5 : 23                  	INC HL
     607/     2C6 : 0D                  	DEC C
     608/     2C7 : C8                  	RET Z
     609/     2C8 : 18 ED               	JR _ASC16_LOOP
     610/     2CA :                     
     611/     2CA :                     ;--------------------------------------------------------------------------------
     612/     2CA :                     ; アドレス部分出力
     613/     2CA :                     ;--------------------------------------------------------------------------------
     614/     2CA :                     ADDR_OUT:
     615/     2CA : CD CC 01            	CALL HEX4OUT
     616/     2CD : CD 36 01            	CALL SPC_PRINT
     617/     2D0 : 3E 3A               	LD A,':'
     618/     2D2 : CF                  	RST 08h
     619/     2D3 : CD 36 01            	CALL SPC_PRINT
     620/     2D6 : C9                  	RET
     621/     2D7 :                     
     622/     2D7 :                     ;--------------------------------------------------------------------------------
     623/     2D7 :                     ; 16バイト分 HEXダンプ出力
     624/     2D7 :                     ;--------------------------------------------------------------------------------
     625/     2D7 :                     DUMP16:
     626/     2D7 : CD CA 02            	CALL ADDR_OUT
     627/     2DA : 0E 10               	LD C,10h
     628/     2DC :                     _DUMP16_LOOP:
     629/     2DC : CD E7 02            	CALL DUMP_AT
     630/     2DF : CD 36 01            	CALL SPC_PRINT
     631/     2E2 : 23                  	INC HL
     632/     2E3 : 0D                  	DEC C
     633/     2E4 : C8                  	RET Z
     634/     2E5 : 18 F5               	JR _DUMP16_LOOP
     635/     2E7 :                     
     636/     2E7 :                     ;--------------------------------------------------------------------------------
     637/     2E7 :                     ; 1バイト分 HEXダンプ出力
     638/     2E7 :                     ;--------------------------------------------------------------------------------
     639/     2E7 :                     DUMP_AT:
     640/     2E7 : 7E                  	LD A,(HL)
     641/     2E8 : CD 3A 01            	CALL HEX2OUT
     642/     2EB : C9                  	RET
     643/     2EC :                     
     644/     2EC :                     ;--------------------------------------------------------------------------------
     645/     2EC :                     ; strlen
     646/     2EC :                     ;--------------------------------------------------------------------------------
     647/     2EC :                     STR_LEN:
     648/     2EC : E5                  	PUSH HL
     649/     2ED : C5                  	PUSH BC
     650/     2EE : 0E 00               	LD C,0
     651/     2F0 :                     _STR_LEN_LOOP:
     652/     2F0 : 7E                  	LD A,(HL)
     653/     2F1 : FE 00               	CP NULL
     654/     2F3 : 28 04               	JR Z,_STR_LEN_EXIT
     655/     2F5 : 23                  	INC HL
     656/     2F6 : 0C                  	INC C
     657/     2F7 : 18 F7               	JR _STR_LEN_LOOP
     658/     2F9 :                     ;
     659/     2F9 :                     _STR_LEN_EXIT:
     660/     2F9 : 79                  	LD A,C
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 12 - 2019/04/24 21時44分12秒


     661/     2FA : C1                  	POP BC
     662/     2FB : E1                  	POP HL
     663/     2FC : C9                  	RET
     664/     2FD :                     ;
     665/     2FD :                     ;================================================================================
     666/     2FD :                     ; メモリー変更コマンド
     667/     2FD :                     ;================================================================================
     668/     2FD :                     MEM_CHANGE:
     669/     2FD : CD 36 01                CALL SPC_PRINT
     670/     300 :                     ;
     671/     300 : CD C3 00                CALL STRIN
     672/     303 : CD D7 01            	CALL PARSER
     673/     306 :                     ;
     674/     306 :                     ; 入力パラメータ数チェック
     675/     306 : 3A 82 40            	LD A,(ARGC)
     676/     309 : FE 01               	CP 1
     677/     30B : 20 93               	JR NZ,_PARAM_ERR
     678/     30D :                     ;
     679/     30D :                     ; 開始アドレス取得
     680/     30D : 2A 83 40            	LD HL,(ARGV_1)
     681/     310 : CD 46 02            	CALL HEX4BIN
     682/     313 : 38 8B               	JR C,_PARAM_ERR
     683/     315 : E5                  	PUSH HL
     684/     316 : DD E1               	POP IX
     685/     318 :                     ;
     686/     318 : CD 2F 01            	CALL CRLF_PRINT
     687/     31B :                     _MEM_CHANGE_LOOP:
     688/     31B : DD E5               	PUSH IX
     689/     31D : E1                  	POP HL
     690/     31E : CD CA 02            	CALL ADDR_OUT
     691/     321 : DD 7E 00            	LD A,(IX+0)
     692/     324 : CD 3A 01            	CALL HEX2OUT
     693/     327 : 3E 2D               	LD A,'-'
     694/     329 : CD 29 01            	CALL CPRINT
     695/     32C : DD E5               	PUSH IX
     696/     32E :                     ;
     697/     32E : CD C3 00                CALL STRIN
     698/     331 : DA 6D 03            	JP C,_MEM_CHANGE_EXIT
     699/     334 : CD D7 01            	CALL PARSER
     700/     337 :                     ; 入力パラメータ数/レングスチェック
     701/     337 : 3A 82 40            	LD A,(ARGC)
     702/     33A : FE 00               	CP 0
     703/     33C : 28 1F               	JR Z,_NEXT_ADDR
     704/     33E : FE 01               	CP 1
     705/     340 : 20 21               	JR NZ,_HATENA_OUT
     706/     342 : 2A 83 40            	LD HL,(ARGV_1)
     707/     345 : CD EC 02            	CALL STR_LEN
     708/     348 : FE 02               	CP 2
     709/     34A : 20 17               	JR NZ,_HATENA_OUT
     710/     34C : 2A 83 40            	LD HL,(ARGV_1)
     711/     34F : CD 19 02            	CALL HEX2BIN
     712/     352 : 38 0F               	JR C,_HATENA_OUT
     713/     354 : DD E1               	POP IX
     714/     356 : DD 77 00            	LD (IX+0),A
     715/     359 : DD 23               	INC IX
     716/     35B : 18 BE               	JR _MEM_CHANGE_LOOP
     717/     35D :                     ;
     718/     35D :                     _NEXT_ADDR:
     719/     35D : DD E1               	POP IX
     720/     35F : DD 23               	INC IX
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 13 - 2019/04/24 21時44分12秒


     721/     361 : 18 B8               	JR _MEM_CHANGE_LOOP
     722/     363 :                     ;
     723/     363 :                     _HATENA_OUT:
     724/     363 : 21 B4 05            	LD HL,HATENA_MSG
     725/     366 : CD 20 01            	CALL STRPR
     726/     369 : DD E1               	POP IX
     727/     36B : 18 AE               	JR _MEM_CHANGE_LOOP
     728/     36D :                     ;
     729/     36D :                     _MEM_CHANGE_EXIT:
     730/     36D : DD E1               	POP IX
     731/     36F : CD 2F 01            	CALL CRLF_PRINT
     732/     372 : C9                  	RET ;ESCキーでメイン処理へ
     733/     373 :                     
     734/     373 :                     ;
     735/     373 :                     ;================================================================================
     736/     373 :                     ; プログラム実行(G)コマンド
     737/     373 :                     ;================================================================================
     738/     373 :                     PGM_GO:
     739/     373 : CD 36 01                CALL SPC_PRINT
     740/     376 :                     ;
     741/     376 : CD C3 00                CALL STRIN
     742/     379 : CD D7 01            	CALL PARSER
     743/     37C :                     ;
     744/     37C :                     ; 入力パラメータ数チェック
     745/     37C : 3A 82 40            	LD A,(ARGC)
     746/     37F : FE 01               	CP 1
     747/     381 :                     ;
     748/     381 :                     ; 実行アドレス取得
     749/     381 :                     ;
     750/     381 : 2A 83 40            	LD HL,(ARGV_1)
     751/     384 : CD EC 02            	CALL STR_LEN
     752/     387 : FE 04               	CP 4
     753/     389 : C2 A0 02            	JP NZ,_PARAM_ERR
     754/     38C :                     ;
     755/     38C : 2A 83 40            	LD HL,(ARGV_1)
     756/     38F : CD 46 02            	CALL HEX4BIN
     757/     392 : DA A0 02            	JP C,_PARAM_ERR
     758/     395 : E9                  	JP (HL)
     759/     396 :                     ;
     760/     396 :                     ;
     761/     396 :                     ;================================================================================
     762/     396 :                     ; I/O入力コマンド
     763/     396 :                     ;================================================================================
     764/     396 :                     IO_IN:
     765/     396 : CD 36 01                CALL SPC_PRINT
     766/     399 :                     ;
     767/     399 : CD C3 00                CALL STRIN
     768/     39C : CD D7 01            	CALL PARSER
     769/     39F :                     ;
     770/     39F :                     ; 入力パラメータ数チェック
     771/     39F : 3A 82 40            	LD A,(ARGC)
     772/     3A2 : FE 01               	CP 1
     773/     3A4 : C2 A0 02            	JP NZ,_PARAM_ERR
     774/     3A7 :                     ;
     775/     3A7 :                     ; I/Oアドレス取得
     776/     3A7 : 2A 83 40            	LD HL,(ARGV_1)
     777/     3AA : CD EC 02            	CALL STR_LEN
     778/     3AD : FE 02               	CP 2
     779/     3AF : C2 A0 02            	JP NZ,_PARAM_ERR
     780/     3B2 :                     ;
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 14 - 2019/04/24 21時44分12秒


     781/     3B2 : 2A 83 40            	LD HL,(ARGV_1)
     782/     3B5 : CD 19 02            	CALL HEX2BIN
     783/     3B8 : DA A0 02            	JP C,_PARAM_ERR
     784/     3BB : 4F                  	LD C,A
     785/     3BC : ED 78               	IN A,(C)
     786/     3BE :                     ;
     787/     3BE : CD 3A 01            	CALL HEX2OUT
     788/     3C1 : CD 2F 01            	CALL CRLF_PRINT
     789/     3C4 : C9                  	RET
     790/     3C5 :                     ;
     791/     3C5 :                     ;================================================================================
     792/     3C5 :                     ; I/O出力コマンド
     793/     3C5 :                     ;================================================================================
     794/     3C5 :                     IO_OUT:
     795/     3C5 : CD 36 01                CALL SPC_PRINT
     796/     3C8 :                     ;
     797/     3C8 : CD C3 00                CALL STRIN
     798/     3CB : CD D7 01            	CALL PARSER
     799/     3CE :                     ;
     800/     3CE :                     ; 入力パラメータ数チェック
     801/     3CE : 3A 82 40            	LD A,(ARGC)
     802/     3D1 : FE 02               	CP 2
     803/     3D3 : C2 A0 02            	JP NZ,_PARAM_ERR
     804/     3D6 :                     ;
     805/     3D6 :                     ; I/Oアドレス取得
     806/     3D6 : 2A 83 40            	LD HL,(ARGV_1)
     807/     3D9 : CD EC 02            	CALL STR_LEN
     808/     3DC : FE 02               	CP 2
     809/     3DE : C2 A0 02            	JP NZ,_PARAM_ERR
     810/     3E1 :                     ;
     811/     3E1 : 2A 83 40            	LD HL,(ARGV_1)
     812/     3E4 : CD 19 02            	CALL HEX2BIN
     813/     3E7 : DA A0 02            	JP C,_PARAM_ERR
     814/     3EA : 4F                  	LD C,A
     815/     3EB :                     ;
     816/     3EB :                     ; 出力データ取得
     817/     3EB : 2A 85 40            	LD HL,(ARGV_2)
     818/     3EE : CD EC 02            	CALL STR_LEN
     819/     3F1 : FE 02               	CP 2
     820/     3F3 : C2 A0 02            	JP NZ,_PARAM_ERR
     821/     3F6 :                     ;
     822/     3F6 : 2A 85 40            	LD HL,(ARGV_2)
     823/     3F9 : CD 19 02            	CALL HEX2BIN
     824/     3FC : DA A0 02            	JP C,_PARAM_ERR
     825/     3FF :                     ;
     826/     3FF : ED 79               	OUT (C),A
     827/     401 :                     ;
     828/     401 : CD 2F 01            	CALL CRLF_PRINT
     829/     404 : C9                  	RET
     830/     405 :                     ;================================================================================
     831/     405 :                     ; インテルHEXロードコマンド
     832/     405 :                     ;================================================================================
     833/     405 :                     LOAD:
     834/     405 : CD 2F 01            	CALL CRLF_PRINT
     835/     408 :                     ;
     836/     408 :                     _LOAD_START:
     837/     408 : D7                  	RST 10h
     838/     409 : FE 1B               	CP ESC
     839/     40B : 28 48               	JR Z,_LOAD_EXIT
     840/     40D : FE 3A               	CP ':'
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 15 - 2019/04/24 21時44分12秒


     841/     40F : 20 F7               	JR NZ,_LOAD_START
     842/     411 : CF                  	RST 08h
     843/     412 :                     ;
     844/     412 :                     ; LENGTH GET
     845/     412 : 06 00               	LD B,0
     846/     414 : CD C3 00                CALL STRIN
     847/     417 :                     ;
     848/     417 : 21 45 40            	LD HL,INBUF
     849/     41A : CD 19 02            	CALL HEX2BIN
     850/     41D : 4F                  	LD C,A
     851/     41E : 47                  	LD B,A
     852/     41F :                     ;
     853/     41F :                     ; ADDR GET
     854/     41F : 21 47 40            	LD HL,INBUF+2
     855/     422 : CD 46 02            	CALL HEX4BIN
     856/     425 : E5                  	PUSH HL
     857/     426 : DD E1               	POP IX
     858/     428 : 78                  	LD A,B
     859/     429 : 84                  	ADD A,H
     860/     42A : 85                  	ADD A,L
     861/     42B : 47                  	LD B,A
     862/     42C :                     ;
     863/     42C :                     ; GET RECORD TYPE
     864/     42C : 21 4B 40            	LD HL,INBUF+6
     865/     42F : CD 19 02            	CALL HEX2BIN
     866/     432 : B7                  	OR A
     867/     433 : 20 20               	JR NZ,_LOAD_EXIT
     868/     435 :                     ;
     869/     435 :                     _MEM_LOAD_START:
     870/     435 : 21 4D 40            	LD HL,INBUF+8
     871/     438 :                     _MEM_LOAD:
     872/     438 : CD 19 02            	CALL HEX2BIN
     873/     43B : DD 77 00            	LD (IX+0),A
     874/     43E : 80                  	ADD A,B
     875/     43F : 47                  	LD B,A
     876/     440 : 23                  	INC HL
     877/     441 : DD 23               	INC IX
     878/     443 : 0D                  	DEC C
     879/     444 : 20 F2               	JR NZ,_MEM_LOAD
     880/     446 :                     ;
     881/     446 : CD 19 02            	CALL HEX2BIN
     882/     449 : 80                  	ADD A,B
     883/     44A : B7                  	OR A
     884/     44B : 20 02               	JR NZ,_CHECKSUM_ERROR
     885/     44D : 18 B9               	JR _LOAD_START
     886/     44F :                     ;
     887/     44F :                     _CHECKSUM_ERROR:
     888/     44F : 21 A0 05            	LD HL,CHECKSUM_ERRMSG
     889/     452 : C3 C2 01            	JP _PRINT_END
     890/     455 :                     ;
     891/     455 :                     _LOAD_EXIT:
     892/     455 : C9                  	RET
     893/     456 :                     ;
     894/     456 :                     ;--------------------------------------------------------------------------------
     895/     456 :                     ; コマンドテーブル
     896/     456 :                     ;--------------------------------------------------------------------------------
     897/     456 :                     CMD_TBL:
     898/     456 : 48                      DB 'H'
     899/     457 : B8 01                   DW HELP_OUT
     900/     459 : 3F                      DB '?'
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 16 - 2019/04/24 21時44分12秒


     901/     45A : B8 01                   DW HELP_OUT
     902/     45C : 56                      DB 'V'
     903/     45D : BD 01                   DW VERSION_OUT
     904/     45F : 44                      DB 'D'
     905/     460 : 54 02                   DW MEM_DUMP
     906/     462 : 4D                      DB 'M'
     907/     463 : FD 02                   DW MEM_CHANGE
     908/     465 : 47                      DB 'G'
     909/     466 : 73 03                   DW PGM_GO
     910/     468 : 49                      DB 'I'
     911/     469 : 96 03                   DW IO_IN
     912/     46B : 4F                      DB 'O'
     913/     46C : C5 03                   DW IO_OUT
     914/     46E : 4C                      DB 'L'
     915/     46F : 05 04                   DW LOAD
     916/     471 :                     ; TABLE END
     917/     471 : 00                      DB 00h
     918/     472 :                     ;
     919/     472 :                     ;--------------------------------------------------------------------------------
     920/     472 :                     ; メッセージなど
     921/     472 :                     ;--------------------------------------------------------------------------------
     922/     472 : =KUNI-NET Z8..      VERNAME EQU "KUNI-NET Z80 MONITOR v0.5"
     923/     472 : 4B 55 4E 49 2D 4E   VERMSG  DB VERNAME,CR,0
                    45 54 20 5A 38 30 
                    20 4D 4F 4E 49 54 
                    4F 52 20 76 30 2E 
                    35 0D 00 
     924/     48D : 0D 0D 2A 2A 20 4B   OPENMSG DB CR,CR,"** ",VERNAME," **",CR,0
                    55 4E 49 2D 4E 45 
                    54 20 5A 38 30 20 
                    4D 4F 4E 49 54 4F 
                    52 20 76 30 2E 35 
                    20 2A 2A 0D 00 
     925/     4B0 : 08 20 08 00         BSTXT	DB BS,SPC,BS,0
     926/     4B4 : 2D 20 2D 20 2D 20   HELP_MSG DB "- - - COMMAND HELP - - -",CR
                    43 4F 4D 4D 41 4E 
                    44 20 48 45 4C 50 
                    20 2D 20 2D 20 2D 
                    0D 
     927/     4CD : 4D 20 58 58 58 58            DB "M XXXX ",TAB,TAB,"MEMORY EDIT",CR
                    20 09 09 4D 45 4D 
                    4F 52 59 20 45 44 
                    49 54 0D 
     928/     4E2 : 44 20 58 58 58 58            DB "D XXXX XXXX ",TAB,"MEMORY DUMP",CR
                    20 58 58 58 58 20 
                    09 4D 45 4D 4F 52 
                    59 20 44 55 4D 50 
                    0D 
     929/     4FB : 47 20 58 58 58 58            DB "G XXXX",TAB,TAB,"PROGRAM EXECUTE",CR
                    09 09 50 52 4F 47 
                    52 41 4D 20 45 58 
                    45 43 55 54 45 0D 
     930/     513 : 49 20 58 58 09 09            DB "I XX",TAB,TAB,"I/O INPUT",CR
                    49 2F 4F 20 49 4E 
                    50 55 54 0D 
     931/     523 : 4F 20 58 58 20 58            DB "O XX XX",TAB,TAB,"I/O OUTPUT",CR
                    58 09 09 49 2F 4F 
                    20 4F 55 54 50 55 
                    54 0D 
     932/     537 : 4C 20 09 09 49 4E            DB "L ",TAB,TAB,"INTEL HEX LOAD",CR
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 17 - 2019/04/24 21時44分12秒


                    54 45 4C 20 48 45 
                    58 20 4C 4F 41 44 
                    0D 
     933/     54A : 48 20 09 09 48 45            DB "H ",TAB,TAB,"HELP MESSGAE",CR
                    4C 50 20 4D 45 53 
                    53 47 41 45 0D 
     934/     55B : 56 20 09 09 56 45            DB "V ",TAB,TAB,"VERSION INFOMATION",CR,0
                    52 53 49 4F 4E 20 
                    49 4E 46 4F 4D 41 
                    54 49 4F 4E 0D 00 
     935/     573 : 07 2A 2A 20 50 41   PARAM_ERRMSG DB BEEP,"** PARAMETER ERR",CR,0
                    52 41 4D 45 54 45 
                    52 20 45 52 52 0D 
                    00 
     936/     586 : 07 2A 2A 20 4D 45   ABORT_MSG DB BEEP,"** MEM DUMP ABORTED END",CR,0
                    4D 20 44 55 4D 50 
                    20 41 42 4F 52 54 
                    45 44 20 45 4E 44 
                    0D 00 
     937/     5A0 : 07 2A 2A 20 43 48   CHECKSUM_ERRMSG DB BEEP,"** CHECKSUM ERROR",CR,0
                    45 43 4B 53 55 4D 
                    20 45 52 52 4F 52 
                    0D 00 
     938/     5B4 : 0D 3F 0D 00         HATENA_MSG DB CR,"?",CR,0
     939/     5B8 :                     
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 18 - 2019/04/24 21時44分12秒


  symbol table (* = unused):
  ------------------------

 ABORT_MSG :                    586 C |  ADDR_OUT :                     2CA C |
*ARCHITECTURE :    x86_64-apple-osx - |  ARGC :                        4082 C |
 ARGV_1 :                      4083 C |  ARGV_2 :                      4085 C |
*ARGV_3 :                      4087 C |  ARG_AREA_LEN :                   7 - |
 ARG_MAX :                        3 - |  ASC16 :                        2AC C |
*BASFLG :                      4044 C |  BEEP :                           7 - |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
 BS :                             8 - |  BSTXT :                        4B0 C |
 BUFEMP :                         5 - |  BUFFUL :                        30 - |
 BUFSIZ :                        3F - | *CASESENSITIVE :                  0 - |
 CHECKSUM_ERRMSG :              5A0 C |  CIN :                           79 C |
 CKINCHAR :                      B3 C | *CLS :                            C - |
 CMD_TBL :                      456 C | *CONSTPI :        3.141592653589793 - |
 COUT :                          A7 C |  COUT1 :                         A8 C |
 CPRINT :                       129 C |  CR :                             D - |
 CRLF_PRINT :                   12F C | *CTRLC :                          3 - |
*DATE :                  2019/04/24 - |  DEL :                           7F - |
 DUMP16 :                       2D7 C |  DUMP_AT :                      2E7 C |
 ESC :                           1B - | *FALSE :                          0 - |
*FULLPMMU :                       1 - |  GETC :                          B9 C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HATENA_MSG :                   5B4 C |  HELP_MSG :                     4B4 C |
 HELP_OUT :                     1B8 C |  HEX2BIN :                      219 C |
 HEX2OUT :                      13A C |  HEX4BIN :                      246 C |
 HEX4OUT :                      1CC C |  INBUF :                       4045 C |
 INEND :                       4081 C | *INEXTMODE :                      0 - |
 INIT :                         157 C | *INLWORDMODE :                    0 - |
 INMAX :                         3C - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
 IO_IN :                        396 C |  IO_OUT :                       3C5 C |
*LF :                             A - | *LISTON :                         1 - |
 LOAD :                         405 C | *MACEXP :                         7 - |
*MAIN :                         17A C |  MEM_CHANGE :                   2FD C |
 MEM_DUMP :                     254 C | *MOMCPU :                        80 - |
*MOMCPUNAME :                   Z80 - | *NESTMAX :                      100 - |
 NOTFUL :                        53 C |  NOTWRP :                        60 C |
 NRWRAP :                        8F C |  NULL :                           0 - |
 OPENMSG :                      48D C | *PACKING :                        0 - |
*PADDING :                        1 - |  PARAM_ERRMSG :                 573 C |
 PARSER :                       1D7 C |  PGM_GO :                       373 C |
*RELAXED :                        0 - | *RST00 :                          0 C |
*RST08 :                          8 C | *RST10 :                         10 C |
*RST18 :                         18 C | *RST38 :                         38 C |
 RTS0 :                          75 C |  RTS1 :                          A3 C |
 RTSHIG :                        17 - |  RTSLOW :                        37 - |
 SERBUF :                      4000 C |  SERCNT :                      4043 C |
 SERINP :                      403F C |  SERINT :                        3B C |
 SERRDP :                      4041 C |  SPC :                           20 - |
 SPC_PRINT :                    136 C |  STACK :                       40A9 - |
 STRIN :                         C3 C |  STRPR :                        120 C |
 STR_LEN :                      2EC C |  TAB :                            9 - |
*TIME :                          21\-26\-10\-1244\-27\-12\-1212\-25\-89\-11 - |
*TRUE :                           1 - |  UARTRC :                         1 - |
 UARTRD :                         0 - |  VERMSG :                       472 C |
 VERNAME :                                        KUNI-NET Z80 MONITOR v0.5 - |
*VERSION :                     142F - |  VERSION_OUT :                  1BD C |
 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 19 - 2019/04/24 21時44分12秒


 _ABORT_DUMP :                  2A6 C |  _ASC16_DOT :                   2C2 C |
 _ASC16_LOOP :                  2B7 C |  _ASC16_PRINT :                 2C4 C |
 _ATOBIN :                      233 C |  _ATOBIN1 :                     243 C |
 _BS_RTN :                      104 C |  _BS_RTN2 :                     10F C |
 _CHAR_SET :                     F6 C |  _CHECKSUM_ERROR :              44F C |
 _CMD_LOOP :                    18F C |  _DUMP16_LOOP :                 2DC C |
 _DUMP_END_CHECK :              29B C |  _DUMP_GO :                     286 C |
 _DUMP_LOOP :                   27E C |  _ERROR_EXIT :                  1AA C |
 _ESC_RTN :                     102 C |  _HATENA_OUT :                  363 C |
 _HEX2BIN_EXIT :                231 C |  _HEX_CNV_PR :                  14F C |
 _LOAD_EXIT :                   455 C |  _LOAD_START :                  408 C |
 _MAIN_LOOP :                   180 C |  _MEM_CHANGE_EXIT :             36D C |
 _MEM_CHANGE_LOOP :             31B C |  _MEM_LOAD :                    438 C |
*_MEM_LOAD_START :              435 C |  _NEXT_ADDR :                   35D C |
 _NEXT_CMD :                    1A2 C |  _PARAM_ERR :                   2A0 C |
 _PARAM_LOOP :                  209 C |  _PARSE_ERR :                   217 C |
 _PARSE_LOOP :                  1ED C |  _PRINT_END :                   1C2 C |
 _STRIN_END :                   11C C |  _STRIN_LOOP :                   D6 C |
 _STR_LEN_EXIT :                2F9 C |  _STR_LEN_LOOP :                2F0 C |
 _WARN_BEEP :                    FD C |

    151 symbols
     40 unused symbols

 AS V1.42 Beta [Bld 137] - source file Z80mon.asm - page 20 - 2019/04/24 21時44分12秒


  codepages:
  ----------

STANDARD (0 changed characters)


0.02 seconds assembly time

    939 lines source file
      2 passes
      0 errors
      0 warnings
